---
title: "Prediction of stroke"
output: html_document
date: "2022-11-18"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Null hypothesis: 
#There is no relationship between the variables like gender, age, various diseases, and smoking status and stroke, the 2nd leading cause of death.

#According to the World Health Organization (WHO) stroke is the 2nd leading cause of death globally, responsible for approximately 11% of total deaths.
#This dataset is used to predict whether a patient is likely to get stroke based on the input parameters like gender, age, various diseases, and smoking status. Each row in the data provides relavant information about the patient.
#Attribute Information

#1) id: unique identifier
#2) gender: "Male", "Female" or "Other"
#3) age: age of the patient
#4) hypertension: 0 if the patient doesn't have hypertension, 1 if the patient has hypertension
#5) heart_disease: 0 if the patient doesn't have any heart diseases, 1 if the patient has a heart disease
#6) ever_married: "No" or "Yes"
#7) work_type: "children", "Govt_jov", "Never_worked", "Private" or "Self-employed"
#8) Residence_type: "Rural" or "Urban"
#9) avg_glucose_level: average glucose level in blood
#10) bmi: body mass index
#11) smoking_status: "formerly smoked", "never smoked", "smokes" or "Unknown"*
#12) stroke: 1 if the patient had a stroke or 0 if not
#*Note: "Unknown" in smoking_status means that the information is unavailable for this patient

```{r}

getwd()
Stroke_dataset <- read.csv("/Users/nehabhasin/Desktop/HS631-STATS/PREDICTION OF STROKE_PROJECT/prediction_of_stroke-project_1/data/Stroke_dataset.csv",header = TRUE, sep = ",")

head(Stroke_dataset)
str(Stroke_dataset)

any(is.na(Stroke_dataset))
colSums(is.na(Stroke_dataset))

```


```{r}

summary(Stroke_dataset)
Stroke_dataset$bmi[is.na(Stroke_dataset$bmi)] <- 0
Stroke_dataset$bmi[Stroke_dataset$bmi==0] <- sample(23.50:28.89,replace=TRUE)

```

```{r}
###Swarna
install.packages("caTools")
install.packages("ggpubr")
install.packages("ggcorrplot")
library(plotly)
library(ggplot2)
library(ggcorrplot)
library(ggpubr)
library(dplyr)
library(VennDiagram)
library(ggbeeswarm)
library(pwr)
library(psych)
library(pastecs)
library(ggm)
library(Hmisc)
library(pwr)
library(car)
library(caTools)
library("MASS")


# Aim to predict if the patient will have stroke
#Does the patient experience stroke
# Null Hypothesis: Patients will not have stroke
#Alternative hypothesis: Patients will have stroke 
#Methodology: Use Multiple logistic regression to predict
#Dependent variable: Stroke
#Independent variables: 10 independent variables
#outcome variable: Stroke
#Quantitative variables: age, avg glucose level, bmi, stroke, sus BP, diaBP, BMI, on admit heart rate
#Categorical: gender, hypertension, heart disease, ever married, work type, residence type, smoking status

Stroke <- read.csv("Stroke_dataset.csv",header = TRUE, sep = ",")
any(is.na(Stroke))
Stroke[is.na(Stroke)] <- 0
summary(Stroke)
str(Stroke)

Stroke <- Stroke[,-15]

Stroke$bmi[Stroke$bmi == 0] <- runif(sum(Stroke$bmi == 0), min = 22.9, max = 32.8)

Stroke$gender <- as.factor(Stroke$gender)
Stroke$ever_married <- as.factor(Stroke$ever_married)
Stroke$work_type <- as.factor(Stroke$work_type)
Stroke$Residence_type <- as.factor(Stroke$Residence_type)
Stroke$smoking_status <- as.factor(Stroke$smoking_status)
Stroke$hypertension <- as.factor(Stroke$hypertension)
Stroke$heart_disease <- as.factor(Stroke$heart_disease)
Stroke$stroke <- as.factor(Stroke$stroke)

summary(Stroke)

plot(Stroke$hypertension,Stroke$age)
plot(Stroke$heart_disease,Stroke$age)
plot(Stroke$stroke,Stroke$age)
plot(Stroke$stroke,Stroke$OnAdmit_heartRate)

ggplot(data=Stroke,aes(x=smoking_status,fill=stroke)) + geom_histogram(stat="count")
ggplot(data=Stroke,aes(x=bmi,fill=stroke)) + geom_density()

ggplot(data=Stroke,aes(x=age)) + geom_density()
ggplot(data=Stroke,aes(x=bmi)) + geom_density()
ggplot(data=Stroke,aes(x=avg_glucose_level)) + geom_density()
ggplot(data=Stroke,aes(x=sysBP)) + geom_density()
ggplot(data=Stroke,aes(x=diaBP)) + geom_density()
ggplot(data=Stroke,aes(x=OnAdmit_heartRate)) + geom_density()

Stroke$logbmi <- log(Stroke$bmi)
ggplot(data=Stroke,aes(x=logbmi)) + geom_density()

Stroke$logglucose <- log(Stroke$avg_glucose_level-45)
ggplot(data=Stroke,aes(x=logglucose)) + geom_density()



split <- sample.split(Stroke$stroke, SplitRatio = 0.8)
TrainStroke <- subset(Stroke,split==TRUE)
TestStroke <- subset(Stroke,split==FALSE)

stat.desc(TrainStroke, basic = FALSE, norm = TRUE)
stat.desc(TestStroke, basic = FALSE, norm = TRUE)

corr = round(cor(Stroke[,c(3,9,10,13,14,15)]),2)
corr

ggcorrplot(corr,hc.order=TRUE)

# strokepredict <- glm(stroke ~ gender + age + hypertension + heart_disease + ever_married + work_type + Residence_type + avg_glucose_level + bmi + smoking_status, data = TrainStroke, family="binomial")
# summary(strokepredict)

# Newstrokepredict <- stepAIC (strokepredict)
# summary(Newstrokepredict)

# ResultStroke <- predict(strokepredict,TestStroke,type="response")

# confmatrix <- table(Actualvalue=TestStroke$stroke, Predictedvalue = ResultStroke >0.5)
# confmatrix

# (confmatrix[[1,1]] + confmatrix[[2,2]])/sum(confmatrix)

Stroke %>% ggplot (aes(x=bmi)) + geom_density()

stat.desc(Stroke, basic = FALSE, norm = TRUE)

hist(Stroke$age)

#applying glm
strokepredict <- glm(stroke ~ gender + age + hypertension + heart_disease + ever_married + work_type + Residence_type + avg_glucose_level + bmi + smoking_status, data = Stroke, family="binomial")
summary(strokepredict)

round (exp(coef(strokepredict)),3)

shapiro.test(Stroke$bmi)
```

